// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  nama        String        @db.VarChar(255)
  nip         String
  alamat      String        @db.Text
  email       String
  password    String        @db.VarChar(255)
  hp          String
  role        Role          @default(Staff)
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)

  transaksi   Transaksi[]   @relation("UserToTransaksi")

  @@map("users")
}

model TahunAjar {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  tahun       String        @unique
  createdAt   DateTime?     @db.Timestamp() @default(now())
  updatedAt   DateTime?     @db.Timestamp()
  deletedAt   DateTime?     @db.Timestamp()

  kelas       kelasSiswa[]  @relation("TahunToKelas")
  spp         Spp[]         @relation("TahunToSpp")
}

model Spp {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  tahunAjarId BigInt        @db.UnsignedBigInt
  spp         BigInt        @db.UnsignedBigInt
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)
  deletedAt   DateTime?     @db.Timestamp(0)

  siswa       SppSiswa[]    @relation("SppToSiswa")
  detail      Detail[]      @relation("SppToDetail")

  tahunAjar   TahunAjar     @relation("TahunToSpp", fields: [tahunAjarId], references: [id])

  @@map("spp")
}

model Kelas {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  namaKelas   String        @db.VarChar(10)
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)
  deletedAt   DateTime?     @db.Timestamp(0)

  siswa       kelasSiswa[]  @relation("KelasToSiswa")

  @@map("kelas")
}

model Siswa {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  nama        String        @db.VarChar(255)
  nis         String
  jk          JenisKelamin
  angkatan    BigInt
  hp          String
  createdAt   DateTime?     @db.Timestamp() @default(now())
  updatedAt   DateTime?     @db.Timestamp()
  deletedAt   DateTime?     @db.Timestamp()

  kelas       kelasSiswa[]  @relation("SiswaToKelas")
  transaksi   Transaksi[]   @relation("SiswaToTransaksi")
  spp         SppSiswa[]    @relation("SiswaToSpp")
  diskon      diskonSiswa[] @relation("SiswaToDiskon")

  @@map("siswa")
}

model kelasSiswa {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  siswaId     BigInt        @db.UnsignedBigInt
  kelasId     BigInt        @db.UnsignedBigInt
  tahunAjarId BigInt        @db.UnsignedBigInt
  createdAt   DateTime?     @db.Timestamp() @default(now())
  updatedAt   DateTime?     @db.Timestamp()
  deletedAt   DateTime?     @db.Timestamp()

  kelas       Kelas         @relation("KelasToSiswa", fields: [kelasId], references: [id])
  siswa       Siswa         @relation("SiswaToKelas", fields: [siswaId], references: [id])
  tahunAjar   TahunAjar     @relation("TahunToKelas", fields: [tahunAjarId], references: [id])
}

model diskonSiswa {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  siswaId     BigInt        @db.UnsignedBigInt
  diskonId    BigInt        @db.UnsignedBigInt
  createdAt   DateTime?     @db.Timestamp() @default(now())
  updatedAt   DateTime?     @db.Timestamp()
  deletedAt   DateTime?     @db.Timestamp()

  diskon      Diskon        @relation("DiskonToSiswa", fields: [diskonId], references: [id])
  siswa       Siswa         @relation("SiswaToDiskon", fields: [siswaId], references: [id])
}

model SppSiswa {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  siswaId     BigInt        @db.UnsignedBigInt
  sppId       BigInt        @db.UnsignedBigInt
  createdAt   DateTime?     @db.Timestamp() @default(now())
  updatedAt   DateTime?     @db.Timestamp()
  deletedAt   DateTime?     @db.Timestamp()

  siswa       Siswa         @relation("SiswaToSpp", fields: [siswaId], references: [id])
  spp         Spp           @relation("SppToSiswa", fields: [sppId], references: [id])

  @@map("spp_siswa")
}

model Transaksi {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  siswaId     BigInt        @db.UnsignedBigInt
  userId      BigInt        @db.UnsignedBigInt
  tanggal     DateTime      @db.Date
  totalBayar  BigInt
  bulan       String
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)
  deletedAt   DateTime?     @db.Timestamp(0)

  siswa       Siswa         @relation("SiswaToTransaksi", fields: [siswaId], references: [id])
  user        User          @relation("UserToTransaksi", fields: [userId], references: [id])

  detail      Detail[]      @relation("TransaksiToDetail")

  @@map("transaksi")
}

model Detail {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  transaksiId BigInt        @db.UnsignedBigInt
  sppId       BigInt        @db.UnsignedBigInt
  jumlahBayar BigInt
  sisa        BigInt
  keterangan  String
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)
  deletedAt   DateTime?     @db.Timestamp(0)

  transaksi   Transaksi     @relation("TransaksiToDetail", fields: [transaksiId], references: [id])
  spp         Spp           @relation("SppToDetail", fields: [sppId], references: [id])
  
  @@map("details")
}

model Diskon {
  id          BigInt        @id @db.UnsignedBigInt @default(autoincrement())
  potongan    BigInt
  createdAt   DateTime?     @db.Timestamp(0) @default(now())
  updatedAt   DateTime?     @db.Timestamp(0)
  deletedAt   DateTime?     @db.Timestamp(0)

  siswa       diskonSiswa[] @relation("DiskonToSiswa")

  @@map("diskon")
}

enum Role {
  Staff
  Admin
}

enum JenisKelamin {
  LakiLaki
  Perempuan
}
